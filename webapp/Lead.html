<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>

<link rel="stylesheet" type="text/css" href="Styles/header.css" />
<link href="styles/lead_style.css" rel="stylesheet" type="text/css" />
<title>Infographics Generator</title>
	<script type="text/javascript" src="Scripts/HandleDate.js"></script>
	<script type="text/javascript" src="Scripts/KPILocalStorage.js"></script>
	<script type="text/javascript" src="Scripts/elements.js"></script>
	<script type="text/javascript" src="Scripts/draw-service.js"></script>
	<script type="text/javascript" src="Scripts/jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="Scripts/jquery.mobile-1.0.1.min.js"></script>
	<!--<script type="text/javascript" src="Scripts/jquery.wipetouch.js"></script>-->
	<script type="text/javascript" src="Scripts/draw-lead.js"></script>
	<script type="text/javascript">
		window.onload = function(){
			LoadJSON();
			DrawLead("myCanvas",initDate());
		};
		
		var checkEle = function () {
			var p = $('#ele');
			var header = $('#header');
			var offset = p.offset();
			var headoff = header.offset();
			
			//elevator shaft begins at 78px
			//size of elevator shaft is 1624px
			//78px - 1702 px
			
			//alert(offset.top);
			
			if (offset.top < 1515 ) {
				$('#ele').offset({top:header.offset().top+78});
			}
			if (offset.top > 1560) { 
				//do nothing so the elevator stops at the bottom
			} else if (offset.top >764) {
				$('#ele').offset({top:offset.top+15});
			}
			
			/*if (offset.top > 1070){
				$('#ele').offset({top:1070});
			} else if (p.offset().top < 1000) {
				$('#ele').offset({top:header.offset().top+78});
			} else if (p.offset().top < 1070) {
				$('#ele').offset({top:p.offset().top});
			} */
		};
		//setInterval(checkEle, 400);
        </script>
    </head>
	<body>
	<div id="main">
		<div id="header">
			<img src="images/header.jpg">
				<a href="javascript:navigator_Go('Index.html');" id="hButton"><img src="images/homeButton2.png"></a>
			<p id="category">Lead</p>
			<p id="month"></p>
			<p id="month2"></p>
		</div>
		
		<div id="ele">
			<img src="images/lead_ele.png"/>
		</div>
		
		<canvas id="myCanvas" width="1000" height="1900">
		<!-- Insert fallback content here -->
		Sorry, your browser doesn't support canvas technology
		</canvas>
		<div id="dialog-box">
			<div class="dialog-content">
				<div id="dialog-message"></div>
				<a href="#" class="button">Close</a>
			</div>
		</div>
		
	</div>
	<script type="text/javascript">	
		/*$(document).wipetouch(
		{
			allowDiagonal:false,
			tapToClick: true,
			wipeLeft: function(result) { wipeStatus("Left",result,3); },
			wipeRight: function(result) { wipeStatus("Right",result,3);},
			wipeUp: false,
			wipeDown: false,
			preventDefault: false,
			moveX: 200,
		});*/
		
		$("#myCanvas").swiperight(function(result) {
			wipeStatus("Right",result,3);
		});
		
		$("#myCanvas").swipeleft(function(result) {
			wipeStatus("Left",result,3);
		});
		

		$('#myCanvas').bind("touchstart click", function(event){
			var heightFactor=1;
			for(var i=0;i <trendArray.length;i++ )
			{
				//check if touching the element location
				if(event.pageX>trendArray[i][1] && event.pageX<(trendArray[i][1]+trendArray[i][3]) && event.pageY>trendArray[i][2] && event.pageY <(trendArray[i][2]+trendArray[i][4])) {
					event.preventDefault();
					//y position of the dialog box
					if(trendArray[i][0]=="Number of Leads" || trendArray[i][0]=="New 3PL Leads" || trendArray[i][0]=="Close Rate" || trendArray[i][0]=="Prospect Count"){
							document.getElementById('dialog-box').style.cssText = "margin-top: 800px";
					}
					else{
						document.getElementById('dialog-box').style.cssText = "margin-top: 200px";
					}
					popup('<table border="0" width="100%">'+
								'<tr>'+
								'<td><canvas id="trendGraph" height="270" width="600"></canvas></td>'+
								'</tr>'+
								'<tr>'+
								'<td>'+trendArray[i][6]+'</td>'+
								'</tr>'+
								'</table>');

						if(trendArray[i][0]=="Number of Leads"){
							heightFactor=0.3;
							for(var j=0;j<trendArray[i][5].length;j++)  {
								drawLineGraph("trendGraph",trendArray[i][5][j][2],trendArray[i][5][j][0],trendArray[i][5][j][1], j,heightFactor,true);
							}
						}else if(trendArray[i][0]=="New 3PL Leads"){
							heightFactor=2.5;
							for(var j=0;j<trendArray[i][5].length;j++)  {
								drawLineGraph("trendGraph",trendArray[i][5][j][2],trendArray[i][5][j][0],trendArray[i][5][j][1], j,heightFactor,false);
							}
						}else{
							if(trendArray[i][0]=="Response by Mail" || trendArray[i][0]=="Unique Customers" || trendArray[i][0]=="Prospect Count"){
								heightFactor=0.1;
							}
							if(trendArray[i][0]=="Response by Phone"){
								heightFactor=0.2;
							}
							if(trendArray[i][0]=="New Sales From Leads" || trendArray[i][0]=="Used Sales From Leads" || trendArray[i][0]=="Lost Sales From Leads"){
								heightFactor=5;
							}
							if(trendArray[i][0]=="Close Rate"){
								heightFactor=2200;
							}
							drawTrend(trendArray[i][5],heightFactor);
						}
					
					//draw x, y axis
					var canvas = document.getElementById("trendGraph");
					var context = canvas.getContext("2d");
					context.save();
					context.beginPath();
					context.moveTo(120,0);
					context.lineTo(120,220);
					context.lineTo(600,220);
					context.strokeStyle = "black";	
					context.stroke();
					context.restore();
				}	
			}
		});
	
		function drawTrend(data,heightFactor) {
			var canvas = document.getElementById("trendGraph");
			var context = canvas.getContext("2d");
			var radius=4;
			context.fillStyle ='#00F';
			var sum=0;
			for(var j=0;j<data.length;j++){
				sum+=data[j][1];
			}
			context.font = "14pt Calibri";
			for(var i=0;i<data.length;i++)
			{
				context.save();
				context.beginPath();
				context.moveTo(150,220-data[0][1]*heightFactor+30);
				context.arc(150, 220-data[0][1]*heightFactor+30, radius, 0, 2 * Math.PI, false);
				context.fillText(data[0][1],142,220-data[0][1]*heightFactor-20+30);
				context.fillText(monthname[0],140,250);
				for(var k=1;k<data.length;k++){
					context.arc(k*70+150, 220-data[k][1]*heightFactor+30, radius, 0, 2 * Math.PI, false);
					context.fillText(monthname[k],k*70+142,250);		//draw month
					context.fillText(data[k][1],k*70+140,220-data[k][1]*heightFactor-20+30); //draw number
					context.lineTo(k*70+150,220-data[k][1]*heightFactor+30);
				}
				context.lineWidth=4;
				context.strokeStyle = "blue";
				context.lineWidth=1;
				context.stroke();
				context.restore();
			}		
		}
		
		function drawLineGraph(c, name, d, color, index, heightFactor, withNum){
			var canvas = document.getElementById(c);
			var context = canvas.getContext("2d");
			context.save();
			context.font = "14pt Calibri";
			context.beginPath();
			context.arc(150, (220-d[0][1]/4*heightFactor), 2, 0, 2 * Math.PI, false);
			context.fillText(monthname[0],145,250);		//draw month
			if(withNum==true)
				context.fillText(d[0][1],130,220-d[0][1]/4*heightFactor-20); //draw number
			context.lineTo(150,(220-d[0][1]/4*heightFactor));
			for(var i=1;i<d.length;i++){
				context.arc(i*70+150, (220-d[i][1]/4*heightFactor), 2, 0, 2 * Math.PI, false);
				context.fillText(monthname[i],i*70+145,250);		//draw month
				if(withNum==true)
					context.fillText(d[i][1],i*70+130,220-d[i][1]/4*heightFactor-20); //draw number
				context.lineTo(i*70+150,(220-d[i][1]/4*heightFactor));
			}
			context.fillStyle = color; // text color
			context.font = "10pt Calibri";
			context.fillText(name, 0, index*20+10);
			context.strokeStyle = color;
			context.stroke();
			context.restore();
		}
	</script>
	</body>
</html>
