<!DOCTYPE HTML>
<html>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width" >
    <head>
		<script type="text/javascript" src="Scripts/HandleDate.js"></script>
		<script type="text/javascript" src="Scripts/KPILocalStorage.js"></script>
		<script type="text/javascript" src="Scripts/elements.js"></script>
		<script type="text/javascript" src="Scripts/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="Scripts/draw-new-sales.js"></script>
		<script type="text/javascript" src="Scripts/jquery.wipetouch.js"></script>
        <script>
            window.onload = function(){
                LoadJSON();
				DrawSalesInfographic("myCanvas",initDate());
            }
        </script>
		<link rel="stylesheet" type="text/css" href="Styles/sales-one-canvas_style.css" />
		<link rel="stylesheet" type="text/css" href="Styles/header.css" />
    </head>
    <body>
		<div id="main">
			<div id="header">
				<img src="images/header.jpg">
				<a href="javascript:navigator_Go('Index.html');" id="hButton"><img src="images/homeButton2.png"></a>
				<p id="category">Sales</p>
				<p id="month"></p>
				<p id="month2"></p>
			</div>
			<canvas id="myCanvas" width="1000" height="2200">
			</canvas>
			<!--fixed later <div id="dialog-overlay"></div>-->
			<div id="dialog-box">
				<div class="dialog-content">
					<div id="dialog-message"></div>
					<a href="#" class="button">Close</a>
				</div>
			</div>
		</div>
		
	<script type="text/javascript">		
		$(document).wipetouch(
		{
			allowDiagonal:false,
			tapToClick: true,
			wipeLeft: function(result) { wipeStatus("Left",result); },
			wipeRight: function(result) { wipeStatus("Right",result);},
            wipeUp: false,
            wipeDown: false,
            preventDefault: false,
            moveX: 200,
		});	
		
		$('#myCanvas').bind("touchstart click", function(event){
		//	Testing for area of Retail Sale
		/*
			var canvas = document.getElementById("myCanvas");
			var context = canvas.getContext("2d");
				context.strokeStyle ="red";
				context.beginPath();
				//canvas.width/2 + 202, 130+207
				context.moveTo(canvas.width/2+202,103);
				context.lineTo(canvas.width/2+202,123+132);
				context.lineTo(canvas.width/2+202+192,123+132);
				context.stroke();
		*/
		//event.preventDefault();
		//http://stackoverflow.com/questions/4780837/is-there-an-equivalent-to-e-pagex-position-for-touchstart-event-as-there-is-fo
		//alert("X: "+event.originalEvent.touches[0].pageX);
		//$('#status').html('X: '+event.pageX);

		for(var i=0;i <trendArray.length;i++ )
		{
			//check if touching the element location
			
			if(event.originalEvent.touches[0].pageX>trendArray[i][1] && event.originalEvent.touches[0].pageX<(trendArray[i][1]+trendArray[i][3]) && event.originalEvent.touches[0].pageY>trendArray[i][2] && event.originalEvent.touches[0].pageY <(trendArray[i][2]+trendArray[i][4]))
			{
				event.preventDefault();
				popup('<table border="1" width="100%">'+
							'<tr>'+
							'<td><canvas id="trendGraph" height="270" width="450"></canvas></td>'+
							'</tr>'+
							'<tr>'+
							'<td>'+trendArray[i][6]+'</td>'+
							'</tr>'+
							'</table>');
				if(trendArray[i][0]!="Pump In Sale"){

					drawTrend(trendArray[i][5]);
				}
				else{
					for(var j=0;j<trendArray[i][5].length;j++){
						drawLineGraph("trendGraph",trendArray[i][5][j][2],trendArray[i][5][j][0],trendArray[i][5][j][1], j);
					}
					var canvas = document.getElementById("trendGraph");
					var context = canvas.getContext("2d");
					context.save();
					context.beginPath();
					context.moveTo(110,0);
					context.lineTo(110,150);
					context.lineTo(270,200);
					context.lineWidth = 2;
					context.strokeStyle = "black";	
					context.stroke();
					context.restore();
				}
				
			}
			
		
			
			//for mouse click on computer
			/*
			if(event.pageX>trendArray[i][1] && event.pageX<(trendArray[i][1]+trendArray[i][3]) && event.pageY>trendArray[i][2] && event.pageY <(trendArray[i][2]+trendArray[i][4]))
			{
				event.preventDefault();
					popup('<table border="0" width="100%">'+
								'<tr>'+
								'<td width="40%">'+trendArray[i][6]+'</td>'+
								'<td width="60%"><canvas id=trendGraph></canvas></td>'+
								'</tr>'+
								'</table>');
				if(trendArray[i][0]!="Pump In Sale"){

					drawTrend(trendArray[i][5]);
				}
				else{
					for(var j=0;j<trendArray[i][5].length;j++){
						drawLineGraph("trendGraph",trendArray[i][0],trendArray[i][5][j][0],trendArray[i][5][j][1], j);
					}
				}
			}
			*/
			
		}

	});
	
	function drawTrend(data) {
		var canvas = document.getElementById("trendGraph");
		var ctx = canvas.getContext("2d");
		ctx.fillStyle ='#00F';
		
		var sum=0;
		for(var i=0;i<data.length;i++){
			sum+=data[i][1];
		}
		
		for(var i=0;i<data.length;i++)
		{
			context.save();
			context.beginPath();
			context.moveTo(0,data[i][1]);
			for(var i=1;i<data.length;i++){
				context.lineTo(i*70+5,data[i][1]);
			}
			context.strokeStyle = "blue";
			context.stroke();
			context.restore();
			/*
			//x, y, w, h
			ctx.fillRect(i*70+15, 240*(1-data[i][1]/sum), 50, 240*data[i][1]/sum);
			//ctx.fillRect(i*30+15, 30+(240-data[i][1]), 50, data[i][1]);
			ctx.fillText(data[i][0], 10+i*30, 150);
			*/
		}		
	}
	
	  function drawLineGraph(c, name, d, color, index){
		var canvas = document.getElementById(c);
        var context = canvas.getContext("2d");
		
			context.save();
			context.beginPath();
			for(var i=0;i<d.length;i++){
				context.lineTo(i*35+5,d[i][1]/5);
			}
			context.fillStyle = color; // text color
			context.fillText(name, 150, index*20+10);
			context.strokeStyle = color;
			context.stroke();
			context.restore();
	  }
		
	</script>
    </body>
</html>
