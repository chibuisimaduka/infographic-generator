<!DOCTYPE HTML>
<html>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width" >
    <head>
		<script type="text/javascript" src="Scripts/HandleDate.js"></script>
		<script type="text/javascript" src="Scripts/KPILocalStorage.js"></script>
		<script type="text/javascript" src="Scripts/elements.js"></script>
		<script type="text/javascript" src="Scripts/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="Scripts/draw-sales.js"></script>
		<script type="text/javascript" src="Scripts/jquery.wipetouch.js"></script>
        <script>
            window.onload = function(){
                LoadJSON();
				DrawSalesInfographic("myCanvas",initDate());
            }
        </script>
		<link rel="stylesheet" type="text/css" href="Styles/sales-one-canvas_style.css" />
		<link rel="stylesheet" type="text/css" href="Styles/header.css" />
    </head>
    <body>
		<div id="main">
			<div id="header">
				<img src="images/header.jpg">
				<a href="javascript:navigator_Go('Index.html');" id="hButton"><img src="images/homeButton2.png"></a>
				<p id="category">Sales</p>
				<p id="month"></p>
				<p id="month2"></p>
			</div>
			<canvas id="myCanvas" width="1000" height="2200">
			</canvas>
			<!--fixed later <div id="dialog-overlay"></div>-->
			<div id="dialog-box">
				<div class="dialog-content">
					<div id="dialog-message"></div>
					<a href="#" class="button">Close</a>
				</div>
			</div>
		</div>
		
	<script type="text/javascript">		
		$(document).wipetouch(
		{
			allowDiagonal:false,
			tapToClick: true,
			wipeLeft: function(result) { wipeStatus("Left",result,1); },
			wipeRight: function(result) { wipeStatus("Right",result,1);},
            wipeUp: false,
            wipeDown: false,
            preventDefault: false,
            moveX: 200,
		});	
		
		$('#myCanvas').bind("touchstart click", function(event){
		//	debug for area
		/*
			var canvas = document.getElementById("myCanvas");
			var context = canvas.getContext("2d");
				context.strokeStyle ="red";
				context.beginPath();
				//canvas.width/2 + 202, 130+207
				context.moveTo(100,1300);
				context.lineTo(100,1500);
				context.lineTo(900,1500);
				context.stroke();
		*/
		//event.preventDefault();
		//http://stackoverflow.com/questions/4780837/is-there-an-equivalent-to-e-pagex-position-for-touchstart-event-as-there-is-fo
		//alert("X: "+event.originalEvent.touches[0].pageX);
		//$('#status').html('X: '+event.pageX);

		for(var i=0;i <trendArray.length;i++ )
		{
			//check if touching the element location
			//if(event.originalEvent.touches[0].pageX>trendArray[i][1] && event.originalEvent.touches[0].pageX<(trendArray[i][1]+trendArray[i][3]) && event.originalEvent.touches[0].pageY>trendArray[i][2] && event.originalEvent.touches[0].pageY <(trendArray[i][2]+trendArray[i][4]))
			//for mouse click on computer
			if(event.pageX>trendArray[i][1] && event.pageX<(trendArray[i][1]+trendArray[i][3]) && event.pageY>trendArray[i][2] && event.pageY <(trendArray[i][2]+trendArray[i][4])) {
				event.preventDefault();
				if(trendArray[i][0]=="Competitive Segment Sale"){
						document.getElementById('dialog-box').style.cssText = "margin-top: 900px";
				} else {
					document.getElementById('dialog-box').style.cssText = "margin-top: -150px";
				}
				popup('<table border="0" width="100%">'+
							'<tr>'+
							'<td><canvas id="trendGraph" height="270" width="600"></canvas></td>'+
							'</tr>'+
							'<tr>'+
							'<td>'+trendArray[i][6]+'</td>'+
							'</tr>'+
							'</table>');
				if(trendArray[i][0]!="Pump In Sale") {
					drawTrend(trendArray[i][5]);
				} else {
					var sortName=new Array();
					sortName=sortstuff(trendArray[i][5]);
					sortName.reverse();
					for(var j=0;j<trendArray[i][5].length;j++)  {
						drawLineGraph("trendGraph",sortName[j],trendArray[i][5][j][0],trendArray[i][5][j][1], j);
					}
				}
				
				//draw x, y axis
				var canvas = document.getElementById("trendGraph");
				var context = canvas.getContext("2d");
				context.save();
				context.beginPath();
				context.moveTo(120,0);
				context.lineTo(120,220);
				context.lineTo(600,220);
				context.strokeStyle = "black";	
				context.stroke();
				context.restore();
			}	
		}
	});
	
	function drawTrend(data) {
		var canvas = document.getElementById("trendGraph");
		var context = canvas.getContext("2d");
		var radius=4;
		context.fillStyle ='#00F';
		
		var sum=0;
		for(var j=0;j<data.length;j++){
			sum+=data[j][1];
		}
		context.font = "14pt Calibri";
		for(var i=0;i<data.length;i++)
		{
			context.save();
			context.beginPath();
			
			context.moveTo(150,data[0][1]);
			context.arc(150, data[0][1], radius, 0, 2 * Math.PI, false);
			context.fillText(monthname[0],145,250);
			for(var k=1;k<data.length;k++){
				context.arc(k*70+150, data[k][1], radius, 0, 2 * Math.PI, false);
				context.fillText(monthname[k],k*70+145,250);		//draw month
				context.lineTo(k*70+150,data[k][1]);
			}
			context.lineWidth=4;
			context.strokeStyle = "blue";
			context.lineWidth=1;
			context.stroke();
			context.restore();
		}		
	}
	
	function drawLineGraph(c, name, d, color, index){
		var canvas = document.getElementById(c);
        var context = canvas.getContext("2d");
		context.save();
		context.font = "14pt Calibri";
		context.beginPath();
		context.arc(150, (200-d[0][1]/4), 2, 0, 2 * Math.PI, false);
		context.fillText(monthname[0],145,250);		//draw month
		context.lineTo(150,(200-d[0][1]/4));
		for(var i=1;i<d.length;i++){
			context.arc(i*70+150, (200-d[i][1]/4), 2, 0, 2 * Math.PI, false);
			context.fillText(monthname[i],i*70+145,250);		//draw month
			context.lineTo(i*70+150,(200-d[i][1]/4));
		}
		context.fillStyle = color; // text color
		context.font = "10pt Calibri";
		context.fillText(name, 0, index*20+10);
		context.strokeStyle = color;
		context.stroke();
		context.restore();
	  }
	  
	function sortstuff(array)  {
		var tmp;
		var name;
		var result=new Array();
		for(var i=0;i<array.length;i++)  {
			tmp=array[i][0][0][1];
			name=array[i][2];
			for(var j=0;j<array.length;j++)  {
				if(array[j][0][0][1]<tmp){
					if(result.indexOf(array[j][2])==-1)  {
						tmp=array[j][0][0][1];
						name=array[j][2];
						result.push(name);
					}
				}
			}
		}
		for(var k=0;k<array.length;k++){
			if(result.indexOf(array[k][2])==-1){
				result.push(array[k][2]);
			}
		}
		return result;
	  }
	</script>
    </body>
</html>
